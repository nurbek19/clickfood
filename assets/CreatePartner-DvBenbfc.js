import{j as e,r as t,W as v,u as z}from"./index-IXhmCcSM.js";import{A as R,P as H,u as U}from"./PhoneInput-CpGXwfZp.js";import{d as $,h as q}from"./index-BVYls5xY.js";const J=({zones:s=[],setZones:a})=>{const i=(r,c,o)=>{const u=[...s];u[r][c]=o,a(u)},n=()=>{a([...s,{radius:0,price:0}])},p=r=>{const c=s.filter((o,u)=>u!==r);a(c)};return e.jsxs("div",{className:"radius-price-form",children:[e.jsx("div",{className:"field-label",children:"Настройка зон доставки"}),s.map((r,c)=>e.jsxs("div",{className:"zone",children:[e.jsx("input",{className:"text-field",type:"number",placeholder:"Радиус (метр)",value:r.radius,onChange:o=>i(c,"radius",o.target.value)}),e.jsx("input",{className:"text-field",type:"number",placeholder:"Стоимость (сом)",value:r.price,onChange:o=>i(c,"price",o.target.value)}),e.jsx("button",{className:"remove-zone-button",onClick:()=>p(c),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",children:e.jsx("path",{d:"M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z"})})})]},c)),e.jsx("button",{className:"secondary-button",onClick:n,children:"Добавить зону"})]})},L=s=>{const a=new Date,[i,n]=(s||"00:00").split(":");return new Date(a.getFullYear(),a.getMonth(),a.getDate(),parseInt(i),parseInt(n)).toISOString().replace(/\.\d{3}Z$/,"Z")},O=s=>s?new Date(s).toTimeString().slice(0,5):"";function G({existingPartner:s=null}){const[a,i]=t.useState(""),[n,p]=t.useState(null),[r,c]=t.useState(""),[o,u]=t.useState(!0),[j,C]=t.useState(!0),[y,D]=t.useState(!1),[x,I]=t.useState(0),[h,k]=t.useState(""),[N,E]=t.useState([]),[w,F]=t.useState(""),[b,T]=t.useState("09:00"),[S,l]=t.useState("22:00"),[A,W]=t.useState(!1);t.useEffect(()=>{var f,m;if(!s)return;i(s.name||""),p(s.address||null),c(s.contact||""),I(s.free_delivery_sum||0),E((s.radius_zones||[]).map(M=>({...M})));const d=s.delivery_options||[];u(d.includes("delivery")),C(d.includes("self_drive")),D(d.includes("preorder")),k(s.photo||""),F(s.finik_id||""),W(s.use_yandex_delivery||!1),(f=s.work_time)!=null&&f.from&&((m=s.work_time)!=null&&m.to)&&(T(O(s.work_time.from)),l(O(s.work_time.to)))},[s]);const B=t.useMemo(()=>{const d=[];return o&&d.push("delivery"),j&&d.push("self_drive"),y&&d.push("preorder"),d},[o,j,y]),_=t.useMemo(()=>({_id:s==null?void 0:s._id,name:a,address:n,contact:r,delivery_options:B,photo:h,free_delivery_sum:parseInt(x),finik_id:w,use_yandex_delivery:A,work_time:{from:L(b),to:L(S)},radius_zones:N.map(d=>({radius:Number(d.radius),price:Number(d.price)}))}),[s==null?void 0:s._id,a,n,r,B,h,x,w,A,b,S,N]),Z=t.useMemo(()=>{if(!s)return!!(a&&n&&r);const{chat_id:d,preorder_service_charge_rate:f,...m}=s;return!$(_,m)},[s,_,a,n,r]);t.useEffect(()=>{v.MainButton.setText(s?"Сохранить":"Создать"),Z?v.MainButton.show():v.MainButton.hide()},[Z,s]);const g=t.useCallback(()=>{console.log("submit",_),v.sendData(JSON.stringify(_))},[_]);t.useEffect(()=>(v.onEvent("mainButtonClicked",g),()=>v.offEvent("mainButtonClicked",g)),[g]);const Y=t.useCallback(async d=>{var M;const f=new FormData;f.append("photo",d);const m=await q.post("/photo/upload",f,{headers:{"Content-Type":"multipart/form-data"}});return(M=m.data)!=null&&M.id&&k(m.data.id),m.data},[]);return{name:a,setName:i,address:n,setAddress:p,phone:r,setPhone:c,delivery:o,setDelivery:u,selfDrive:j,setSelfDrive:C,preorder:y,setPreorder:D,freeDeliverySum:x,setFreeDeliverySum:I,photoId:h,setPhotoId:k,zones:N,setZones:E,finikId:w,setFinikId:F,workStartTime:b,setWorkStartTime:T,workEndTime:S,setWorkEndTime:l,useYandexDelivery:A,setUseYandexDelivery:W,deliveryOptionsArray:B,isChanged:Z,uploadPhoto:Y,submit:g}}const K=({existingPartner:s=null})=>{const{name:a,setName:i,address:n,setAddress:p,phone:r,setPhone:c,delivery:o,setDelivery:u,selfDrive:j,setSelfDrive:C,preorder:y,setPreorder:D,freeDeliverySum:x,setFreeDeliverySum:I,photoId:h,zones:k,setZones:N,workStartTime:E,setWorkStartTime:w,workEndTime:F,setWorkEndTime:b,useYandexDelivery:T,setUseYandexDelivery:S}=G({existingPartner:s});return e.jsxs("div",{className:"partner-form-container",children:[e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"name",className:"field-label",children:"Название"}),e.jsx("input",{type:"text",id:"name",className:"text-field",value:a,onChange:l=>i(l.target.value)})]}),e.jsx(R,{address:n,setAddress:p}),e.jsx(H,{value:r,onChange:c,label:"Контактный номер телефона",placeholder:"+996 555 555 555"}),e.jsxs("div",{className:"field-wrapper switch-buttons",children:[e.jsx("span",{className:"field-label",children:"Варианты заказов"}),e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:l=>C(l.target.checked)}),e.jsx("span",{className:"slider round"}),e.jsx("span",{children:"Самовывоз"})]}),e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:l=>D(l.target.checked)}),e.jsx("span",{className:"slider round"}),e.jsx("span",{children:"Предзаказ"})]}),e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:l=>u(l.target.checked)}),e.jsx("span",{className:"slider round"}),e.jsx("span",{children:"Доставка"})]})]}),e.jsxs("div",{className:"work-time-wrapper",children:[e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"work-start-time",className:"field-label",children:"Время открытия"}),e.jsx("input",{type:"time",id:"work-start-time",className:"text-field",value:E,onChange:l=>w(l.target.value)})]}),e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"work-end-time",className:"field-label",children:"Время закрытия"}),e.jsx("input",{type:"time",id:"work-end-time",className:"text-field",value:F,onChange:l=>b(l.target.value)})]})]}),o&&e.jsxs("div",{className:"field-wrapper switch-buttons",children:[e.jsx("span",{className:"field-label",children:"Настройки доставки"}),e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:l=>S(l.target.checked)}),e.jsx("span",{className:"slider round"}),e.jsx("span",{children:"Использовать Яндекс доставку"})]})]}),o&&e.jsx(J,{zones:k,setZones:N}),e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"free-delivery-sum",className:"field-label",children:"Сумма для бесплатной доставки"}),e.jsx("input",{type:"number",id:"free-delivery-sum",className:"text-field",value:x,onChange:l=>I(l.target.value)})]}),e.jsx("div",{className:"company-phot-container",children:h&&e.jsx("img",{src:`https://booklink.pro/cf/photo?id=${h}`,alt:"company"})})]})},P=()=>{const[s]=z(),a=s.get("chat_id"),{partner:i,isLoading:n}=U({chatId:a});return n?e.jsx("div",{className:"loading",children:"Загрузка..."}):e.jsx(K,{existingPartner:i??null})};export{P as default};
