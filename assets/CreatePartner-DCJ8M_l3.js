import{j as e,r as o,W as k,u as $}from"./index-BhqLDQWW.js";import{A as q,P as J,u as G}from"./PhoneInput-BoeEvwyJ.js";import{u as H}from"./index-DKD98Nho.js";import{d as K,h as Q}from"./index-DeSp45zg.js";const V=({zones:s=[],setZones:r})=>{const u=(l,i,c)=>{const f=[...s];f[l][i]=c,r(f)},d=()=>{r([...s,{radius:0,price:0}])},x=l=>{const i=s.filter((c,f)=>f!==l);r(i)};return e.jsxs("div",{className:"radius-price-form",children:[e.jsx("div",{className:"field-label",children:"Настройка зон доставки"}),s.map((l,i)=>e.jsxs("div",{className:"zone",children:[e.jsx("input",{className:"text-field",type:"number",placeholder:"Радиус (метр)",value:l.radius,onChange:c=>u(i,"radius",c.target.value)}),e.jsx("input",{className:"text-field",type:"number",placeholder:"Стоимость (сом)",value:l.price,onChange:c=>u(i,"price",c.target.value)}),e.jsx("button",{className:"remove-zone-button",onClick:()=>x(i),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",children:e.jsx("path",{d:"M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z"})})})]},i)),e.jsx("button",{className:"secondary-button",onClick:d,children:"Добавить зону"})]})},C=s=>{const r=new Date,[u,d]=s.split(":");return new Date(r.getFullYear(),r.getMonth(),r.getDate(),parseInt(u),parseInt(d)).toISOString().replace(/\.\d{3}Z$/,"Z")},X=({existingPartner:s=null})=>{const[r,u]=o.useState(""),[d,x]=o.useState(null),[l,i]=o.useState(""),[c,f]=o.useState(!0),[y,T]=o.useState(!0),[N,g]=o.useState(!1),[v,F]=o.useState(0),[p,E]=o.useState(""),[j,O]=o.useState([]),[b,L]=o.useState(""),[w,M]=o.useState("09:00"),[S,B]=o.useState("22:00"),[_,W]=o.useState(!1);o.useEffect(()=>{var a,h;if(s){u(s.name||""),x(s.address||null);const m=s.contact||"";i(m),F(s.free_delivery_sum||0),O((s.radius_zones||[]).map(t=>({...t})));const n=s.delivery_options||[];if(f(n.some(t=>t==="delivery")),T(n.some(t=>t==="self_drive")),g(n.some(t=>t==="preorder")),E(s.photo||""),L(s.finik_id||""),W(s.use_yandex_delivery||!1),(a=s.work_time)!=null&&a.from&&((h=s.work_time)!=null&&h.to)){const t=D=>new Date(D).toTimeString().slice(0,5);M(t(s.work_time.from)),B(t(s.work_time.to))}}},[s]);const I=o.useCallback(()=>{const a=[];c&&a.push("delivery"),y&&a.push("self_drive"),N&&a.push("preorder");const h=C(w),m=C(S);k.sendData(JSON.stringify({_id:s==null?void 0:s._id,name:r,address:d,contact:l,delivery_options:a,photo:p,free_delivery_sum:parseInt(v),finik_id:b,use_yandex_delivery:_,work_time:{from:h,to:m},radius_zones:j.map(n=>({radius:Number(n.radius),price:Number(n.price)}))})),console.log({_id:s==null?void 0:s._id,name:r,address:d,contact:l,delivery_options:a,photo:p,free_delivery_sum:parseInt(v),finik_id:b,use_yandex_delivery:_,work_time:{from:h,to:m},radius_zones:j.map(n=>({radius:Number(n.radius),price:Number(n.price)}))})},[s,r,d,l,c,y,N,v,p,b,w,S,j,_]),Z=o.useMemo(()=>{if(s){const a=[];c&&a.push("delivery"),y&&a.push("self_drive"),N&&a.push("preorder");const{chat_id:h,...m}=s,n=C(w),t=C(S),D={_id:s._id,name:r,address:d,contact:l,delivery_options:a,photo:p,free_delivery_sum:parseInt(v),finik_id:b,use_yandex_delivery:_,work_time:{from:n,to:t},radius_zones:j.map(A=>({radius:Number(A.radius),price:Number(A.price)})),preorder_service_charge_rate:0};return!K(D,m)}else return r&&d&&l},[s,r,d,l,c,y,N,v,p,b,w,S,j,_]);o.useEffect(()=>(k.MainButton.setText(s?"Сохранить":"Создать"),Z?k.MainButton.show():k.MainButton.hide(),k.onEvent("mainButtonClicked",I),()=>{k.offEvent("mainButtonClicked",I)}),[Z,I]);const R=o.useCallback(async a=>{var n;const h=a[0],m=new FormData;m.append("photo",h);try{const t=await Q.post("/photo/upload",m,{headers:{"Content-Type":"multipart/form-data"}});(n=t.data)!=null&&n.id&&E(t.data.id),console.log("Uploaded:",t.data)}catch(t){console.error("Upload error:",t)}},[]),{getRootProps:z,getInputProps:U}=H({accept:{"image/*":[]},maxFiles:1,onDrop:R});return e.jsxs("div",{className:"partner-form-container",children:[e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"name",className:"field-label",children:"Название"}),e.jsx("input",{type:"text",id:"name",className:"text-field",value:r,onChange:a=>u(a.target.value)})]}),e.jsx(q,{address:d,setAddress:x}),e.jsx(J,{value:l,onChange:i,label:"Контактный номер телефона",placeholder:"+996 555 555 555"}),e.jsxs("div",{className:"field-wrapper switch-buttons",children:[e.jsx("span",{className:"field-label",children:"Варианты заказов"}),e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:a=>T(a.target.checked)}),e.jsx("span",{className:"slider round"}),e.jsx("span",{children:"Самовывоз"})]}),e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:a=>g(a.target.checked)}),e.jsx("span",{className:"slider round"}),e.jsx("span",{children:"Предзаказ"})]}),e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:a=>f(a.target.checked)}),e.jsx("span",{className:"slider round"}),e.jsx("span",{children:"Доставка"})]})]}),e.jsxs("div",{className:"work-time-wrapper",children:[e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"work-start-time",className:"field-label",children:"Время открытия"}),e.jsx("input",{type:"time",id:"work-start-time",className:"text-field",value:w,onChange:a=>M(a.target.value)})]}),e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"work-end-time",className:"field-label",children:"Время закрытия"}),e.jsx("input",{type:"time",id:"work-end-time",className:"text-field",value:S,onChange:a=>B(a.target.value)})]})]}),c&&e.jsxs("div",{className:"field-wrapper switch-buttons",children:[e.jsx("span",{className:"field-label",children:"Настройки доставки"}),e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:a=>W(a.target.checked)}),e.jsx("span",{className:"slider round"}),e.jsx("span",{children:"Использовать Яндекс доставку"})]})]}),c&&e.jsx(V,{zones:j,setZones:O}),e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"free-delivery-sum",className:"field-label",children:"Сумма для бесплатной доставки"}),e.jsx("input",{type:"number",id:"free-delivery-sum",className:"text-field",value:v,onChange:a=>F(a.target.value)})]}),e.jsxs("div",{...z(),children:[e.jsx("input",{...U()}),e.jsx("button",{className:"secondary-button",children:p?"Заменить фотографию":"Загрузить изображение"}),p&&e.jsx("div",{className:"company-phot-container",children:e.jsx("img",{src:`https://booklink.pro/cf/photo?id=${p}`,alt:"company"})})]})]})},te=()=>{const[s]=$(),r=s.get("chat_id"),{partner:u,isLoading:d}=G({chatId:r});return d?e.jsx("div",{className:"loading",children:"Загрузка..."}):e.jsx(X,{existingPartner:u??null})};export{te as default};
