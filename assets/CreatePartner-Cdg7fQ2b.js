import{j as e,r as t,W as x,u as q}from"./index-vJ1DPzLB.js";import{a as L}from"./tslib.es6-CxTiUbDI.js";import{d as J,u as G}from"./index-WQxfK1J8.js";import{A as H,P as K}from"./PhoneInput-CQ-0-eU2.js";const Q=({zones:s=[],setZones:l})=>{const p=(c,n,o)=>{const u=[...s];u[c][n]=o,l(u)},i=()=>{l([...s,{radius:0,price:0}])},h=c=>{const n=s.filter((o,u)=>u!==c);l(n)};return e.jsxs("div",{className:"radius-price-form",children:[e.jsx("div",{className:"field-label",children:"Настройка зон доставки"}),s.map((c,n)=>e.jsxs("div",{className:"zone",children:[e.jsx("input",{className:"text-field",type:"number",placeholder:"Радиус (метр)",value:c.radius,onChange:o=>p(n,"radius",o.target.value)}),e.jsx("input",{className:"text-field",type:"number",placeholder:"Стоимость (сом)",value:c.price,onChange:o=>p(n,"price",o.target.value)}),e.jsx("button",{className:"remove-zone-button",onClick:()=>h(n),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",children:e.jsx("path",{d:"M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z"})})})]},n)),e.jsx("button",{className:"secondary-button",onClick:i,children:"Добавить зону"})]})},C=s=>{const l=new Date,[p,i]=s.split(":");return new Date(l.getFullYear(),l.getMonth(),l.getDate(),parseInt(p),parseInt(i)).toISOString().replace(/\.\d{3}Z$/,"Z")},V=({existingPartner:s=null})=>{const[l,p]=t.useState(""),[i,h]=t.useState(null),[c,n]=t.useState(""),[o,u]=t.useState(!0),[k,D]=t.useState(!0),[N,T]=t.useState(!1),[j,F]=t.useState(0),[f,E]=t.useState(""),[_,O]=t.useState([]),[b,R]=t.useState(""),[w,M]=t.useState("09:00"),[S,B]=t.useState("22:00"),[y,W]=t.useState(!1);t.useEffect(()=>{var a,v;if(s){p(s.name||""),h(s.address||null);const m=s.contact||"";n(m),F(s.free_delivery_sum||0),O((s.radius_zones||[]).map(r=>({...r})));const d=s.delivery_options||[];if(u(d.some(r=>r==="delivery")),D(d.some(r=>r==="self_drive")),T(d.some(r=>r==="preorder")),E(s.photo||""),R(s.finik_id||""),W(s.use_yandex_delivery||!1),(a=s.work_time)!=null&&a.from&&((v=s.work_time)!=null&&v.to)){const r=I=>new Date(I).toTimeString().slice(0,5);M(r(s.work_time.from)),B(r(s.work_time.to))}}},[s]);const g=t.useCallback(()=>{const a=[];o&&a.push("delivery"),k&&a.push("self_drive"),N&&a.push("preorder");const v=C(w),m=C(S);x.sendData(JSON.stringify({_id:s==null?void 0:s._id,name:l,address:i,contact:c,delivery_options:a,photo:f,free_delivery_sum:parseInt(j),finik_id:b,use_yandex_delivery:y,work_time:{from:v,to:m},radius_zones:_.map(d=>({radius:Number(d.radius),price:Number(d.price)}))})),console.log({_id:s==null?void 0:s._id,name:l,address:i,contact:c,delivery_options:a,photo:f,free_delivery_sum:parseInt(j),finik_id:b,use_yandex_delivery:y,work_time:{from:v,to:m},radius_zones:_.map(d=>({radius:Number(d.radius),price:Number(d.price)}))})},[s,l,i,c,o,k,N,j,f,b,w,S,_,y]),Z=t.useMemo(()=>{if(s){const a=[];o&&a.push("delivery"),k&&a.push("self_drive"),N&&a.push("preorder");const{chat_id:v,...m}=s,d=C(w),r=C(S),I={_id:s._id,name:l,address:i,contact:c,delivery_options:a,photo:f,free_delivery_sum:parseInt(j),finik_id:b,use_yandex_delivery:y,work_time:{from:d,to:r},radius_zones:_.map(A=>({radius:Number(A.radius),price:Number(A.price)})),preorder_service_charge_rate:0};return!J(I,m)}else return l&&i&&c},[s,l,i,c,o,k,N,j,f,b,w,S,_,y]);t.useEffect(()=>(x.MainButton.setText(s?"Сохранить":"Создать"),Z?x.MainButton.show():x.MainButton.hide(),x.onEvent("mainButtonClicked",g),()=>{x.offEvent("mainButtonClicked",g)}),[Z,g]);const z=t.useCallback(async a=>{var d;const v=a[0],m=new FormData;m.append("photo",v);try{const r=await L.post("/photo/upload",m,{headers:{"Content-Type":"multipart/form-data"}});(d=r.data)!=null&&d.id&&E(r.data.id),console.log("Uploaded:",r.data)}catch(r){console.error("Upload error:",r)}},[]),{getRootProps:U,getInputProps:Y}=G({accept:{"image/*":[]},maxFiles:1,onDrop:z});return e.jsxs("div",{className:"partner-form-container",children:[e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"name",className:"field-label",children:"Название"}),e.jsx("input",{type:"text",id:"name",className:"text-field",value:l,onChange:a=>p(a.target.value)})]}),e.jsx(H,{address:i,setAddress:h}),e.jsx(K,{value:c,onChange:n,label:"Контактный номер телефона",placeholder:"+996 555 555 555"}),e.jsxs("div",{className:"field-wrapper switch-buttons",children:[e.jsx("span",{className:"field-label",children:"Варианты заказов"}),e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:a=>D(a.target.checked)}),e.jsx("span",{className:"slider round"}),e.jsx("span",{children:"Самовывоз"})]}),e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:a=>T(a.target.checked)}),e.jsx("span",{className:"slider round"}),e.jsx("span",{children:"Предзаказ"})]}),e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:a=>u(a.target.checked)}),e.jsx("span",{className:"slider round"}),e.jsx("span",{children:"Доставка"})]})]}),e.jsxs("div",{className:"work-time-wrapper",children:[e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"work-start-time",className:"field-label",children:"Время открытия"}),e.jsx("input",{type:"time",id:"work-start-time",className:"text-field",value:w,onChange:a=>M(a.target.value)})]}),e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"work-end-time",className:"field-label",children:"Время закрытия"}),e.jsx("input",{type:"time",id:"work-end-time",className:"text-field",value:S,onChange:a=>B(a.target.value)})]})]}),o&&e.jsxs("div",{className:"field-wrapper switch-buttons",children:[e.jsx("span",{className:"field-label",children:"Настройки доставки"}),e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:a=>W(a.target.checked)}),e.jsx("span",{className:"slider round"}),e.jsx("span",{children:"Использовать Яндекс доставку"})]})]}),o&&e.jsx(Q,{zones:_,setZones:O}),e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"free-delivery-sum",className:"field-label",children:"Сумма для бесплатной доставки"}),e.jsx("input",{type:"number",id:"free-delivery-sum",className:"text-field",value:j,onChange:a=>F(a.target.value)})]}),e.jsxs("div",{...U(),children:[e.jsx("input",{...Y()}),e.jsx("button",{className:"secondary-button",children:f?"Заменить фотографию":"Загрузить изображение"}),f&&e.jsx("div",{className:"company-phot-container",children:e.jsx("img",{src:`https://booklink.pro/cf/photo?id=${f}`,alt:"company"})})]})]})},ae=()=>{const[s]=q(),[l,p]=t.useState(!0),[i,h]=t.useState(null);return t.useEffect(()=>{(async()=>{var n;try{const o=await L.get(`/partner?chat_id=${s.get("chat_id")}`);h(o.data)}catch(o){const u=(n=o.response)==null?void 0:n.status;u===404||u===500?h(null):console.error("Неизвестная ошибка при загрузке партнёра",o)}finally{p(!1)}})()},[s]),l?e.jsx("div",{className:"loading",children:"Загрузка..."}):e.jsx(V,{existingPartner:i})};export{ae as default};
